{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h2>üîß WB API –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

    <!-- –§–æ—Ä–º–∞ —Ç–æ–∫–µ–Ω–∞ -->
    <div class="card p-4 mb-4 shadow-sm">
        <h5>üìù WB API –¢–æ–∫–µ–Ω</h5>
        <form method="post">
            {% csrf_token %}
            <div class="mb-3">
                <label class="form-label fw-bold">–¢–æ–∫–µ–Ω:</label>
                <textarea name="api_key" class="form-control" rows="4"
                        placeholder="ins860347... –∏–∑ WB –õ–ö ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏">{{ token.api_key|default:"" }}</textarea>
            </div>
            <button type="submit" class="btn btn-primary w-100">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ —Ç–µ—Å—Ç</button>
        </form>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ -->
    {% if test_result %}
    <div class="card shadow-sm mb-4 {% if test_result.ok %}border-success bg-success-subtle{% else %}border-danger bg-danger-subtle{% endif %}">
        <div class="card-header d-flex justify-content-between">
            <h5>üîç –¢–µ—Å—Ç API</h5>
            <span class="badge {% if test_result.ok %}bg-success{% else %}bg-danger{% endif %}">
                {{ test_result.status_code }}
            </span>
        </div>
        <div class="card-body">
            {% if test_result.ok %}
                <div class="alert alert-success">
                    ‚úÖ <strong>–¢–û–ö–ï–ù –†–ê–ë–û–¢–ê–ï–¢!</strong><br>
                    Status: {{ test_result.status_code }}
                </div>
                <a href="{% url 'sync_wb_products' %}" class="btn btn-success btn-lg w-100">
                    üöÄ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã WB
                </a>
            {% else %}
                <div class="alert alert-danger">
                    ‚ùå –û—à–∏–±–∫–∞ {{ test_result.status_code }}
                </div>
            {% endif %}

            <!-- ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–´–ô –≤—ã–≤–æ–¥ –æ—Ç–≤–µ—Ç–∞ -->
            <details class="mt-3">
                <summary>–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞</summary>
                <pre class="small bg-light p-3 rounded">{{ test_result.text }}</pre>
            </details>
        </div>
    </div>
    {% endif %}

    <div class="mt-4">
        <a href="{% url 'dashboard' %}" class="btn btn-secondary">üè† Dashboard</a>
        <a href="{% url 'sync_wb_products' %}" class="btn btn-outline-primary">üì¶ –¢–æ–≤–∞—Ä—ã</a>
    </div>
</div>
{% endblock %}
